// Prisma schema

generator client {
  provider = "prisma-client-js"
}

generator zod {
  provider = "prisma-zod-generator"
  output   = "./src/zod"
  skipFiles = ["updateManyAndReturn*.schema.ts", "*ScalarRelationFilter.schema.ts"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  ADVANCED
  USER
}

enum DocStatus {
  DRAFT
  SIGNED
}

model User {
  id           Int      @id @default(autoincrement())
  name         String?
  email        String   @unique
  passwordHash String
  role         Role     @default(USER)
  permissions  Json?
  locale       String   @default("pl")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model RolePermissions {
  id          Int      @id @default(autoincrement())
  module      String   @unique
  userAccess  Boolean  @default(false)
  advancedAccess Boolean @default(false)
  adminAccess Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Client {
  id           Int        @id @default(autoincrement())
  name         String
  email        String?
  phone        String?
  address      String?
  city         String?
  postalCode   String?
  country      String?     @default("Polska")
  nip          String?
  regon        String?
  legalForm    String?     // np. "Sp. z o.o.", "S.A.", "JDG", etc.
  bankAccount  String?
  notes        String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  documents    Document[]
  invoices     Invoice[]
  authors      Author[]   // Relacja: jeden klient może mieć wiele osób
}

model Author {
  id            Int      @id @default(autoincrement())
  firstName     String
  middleName    String?
  lastName      String
  description   String?
  workEmail     String?
  personalEmail String?
  photos        Json?
  clientId      Int?     // Relacja: osoba może być przypisana do jednego klienta
  client        Client?  @relation(fields: [clientId], references: [id], onDelete: SetNull)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Document {
  id          Int        @id @default(autoincrement())
  title       String
  description String?
  status      DocStatus  @default(DRAFT)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  clientId    Int
  client      Client     @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

model Invoice {
  id         Int      @id @default(autoincrement())
  clientId   Int
  client     Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  title      String
  issueDate  DateTime
  paymentDate DateTime
  net        Float
  vatPerc    Int
  vat        Float
  gross      Float
  status     String   @default("issued") // 'issued' | 'planned'
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model BalanceAdjustment {
  id          Int      @id @default(autoincrement())
  date        DateTime
  amount      Float
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
