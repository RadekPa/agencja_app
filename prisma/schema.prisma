// Prisma schema

generator client {
  provider = "prisma-client-js"
}

generator zod {
  provider = "prisma-zod-generator"
  output   = "./src/zod"
  skipFiles = ["updateManyAndReturn*.schema.ts", "*ScalarRelationFilter.schema.ts"]
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model User {
  id           Int      @id @default(autoincrement())
  name         String?
  email        String   @unique
  passwordHash String
  role         String   @db.NVarChar(32) @default("USER")
  permissions  String?  @db.NVarChar(Max)
  locale       String   @default("pl")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model RolePermissions {
  id          Int      @id @default(autoincrement())
  module      String   @unique
  userAccess  Boolean  @default(false)
  advancedAccess Boolean @default(false)
  adminAccess Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Client {
  id           Int        @id @default(autoincrement())
  name         String
  email        String?
  phone        String?
  address      String?
  city         String?
  postalCode   String?
  country      String?     @default("Polska")
  nip          String?
  regon        String?
  legalForm    String?     // np. "Sp. z o.o.", "S.A.", "JDG", etc.
  bankAccount  String?
  notes        String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  documents    Document[]
  invoices     Invoice[]
}

model Author {
  id              Int      @id @default(autoincrement()) @map("ContactID")
  phoneNumber     String?  @db.VarChar(20) @map("PhoneNumber")
  firstName       String   @db.VarChar(30) @map("FirstName")
  middleName      String?  @db.VarChar(30) @map("MiddleName")
  lastName        String   @db.VarChar(50) @map("LastName")
  informal        Int      @default(0) @map("Informal")
  fax             String?  @db.VarChar(20) @map("Fax")
  email           String?  @db.VarChar(50) @map("Email")
  userMod         String   @default("suser_sname()") @db.VarChar(30) @map("UserMod")
  dateMod         DateTime @default(now()) @map("DateMod")
  contactPosition String?  @db.VarChar(50) @map("ContactPosition")
  accountant      Int?     @map("Accountant")

  @@map("tblContacts")
}

model Document {
  id          Int        @id @default(autoincrement())
  title       String
  description String?
  status      String     @db.NVarChar(32) @default("DRAFT")
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  clientId    Int
  client      Client     @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

model Invoice {
  id         Int      @id @default(autoincrement())
  clientId   Int
  client     Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  title      String
  issueDate  DateTime
  paymentDate DateTime
  net        Float
  vatPerc    Int
  vat        Float
  gross      Float
  status     String   @default("issued") // 'issued' | 'planned'
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model BalanceAdjustment {
  id          Int      @id @default(autoincrement())
  date        DateTime
  amount      Float
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
